generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPERADMIN
  ADMIN
  TEACHER
  STUDENT
}

enum Status {
  ACTIVE
  INACTIVE
  COMPLETED
  PLANNED
  GRADUATED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
}

enum PaymentMethod {
  CASH
  CARD
  TRANSFER
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

model Staff {
  id             Int       @id @default(autoincrement())
  firstName      String    @map("first_name") @db.VarChar(100)
  lastName       String    @map("last_name") @db.VarChar(100)
  username       String    @unique @db.VarChar(50)
  password       String    @db.VarChar(255)
  role           Role
  position       String    @db.VarChar(100)
  phone          String?   @db.VarChar(20)
  address        String?   @db.Text
  hireDate       DateTime  @default(now()) @map("hire_date") @db.Date
  status         Status    @default(ACTIVE)
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  
  groups         Group[]
  lessons        Lesson[]
  attendances    Attendance[]
  payments       Payment[]
  
  @@map("staffs")
}

model Student {
  id                Int              @id @default(autoincrement())
  firstName         String           @map("first_name") @db.VarChar(100)
  lastName          String           @map("last_name") @db.VarChar(100)
  username          String?          @unique @db.VarChar(50)
  password          String?          @db.VarChar(255)
  phone             String?          @db.VarChar(20)
  address           String?          @db.Text
  birthDate         DateTime?        @map("birth_date") @db.Date
  status            Status           @default(ACTIVE)
  enrollmentDate    DateTime         @default(now()) @map("enrollment_date") @db.Date
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  
  studentGroups     StudentGroup[]
  attendanceDetails AttendanceDetail[]
  payments          Payment[]
  
  @@map("students")
}

model Course {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(100)
  description String?      @db.Text
  price       Int
  duration    Int
  level       CourseLevel?
  isActive    Boolean      @default(true) @map("is_active")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  
  groups      Group[]
  
  @@map("courses")
}

model Group {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(50)
  courseId    Int       @map("course_id")
  teacherId   Int       @map("teacher_id")
  startDate   DateTime  @map("start_date") @db.Date
  endDate     DateTime? @map("end_date") @db.Date
  schedule    String?   @db.Text
  maxStudents Int       @default(20) @map("max_students")
  status      Status    @default(PLANNED)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  
  course        Course         @relation(fields: [courseId], references: [id])
  teacher       Staff          @relation(fields: [teacherId], references: [id])
  studentGroups StudentGroup[]
  lessons       Lesson[]
  schedules     Schedule[]
  payments      Payment[]
  
  @@map("groups")
}

model StudentGroup {
  id        Int      @id @default(autoincrement())
  studentId Int      @map("student_id")
  groupId   Int      @map("group_id")
  joinDate  DateTime @default(now()) @map("join_date") @db.Date
  status    Status   @default(ACTIVE)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  student Student @relation(fields: [studentId], references: [id])
  group   Group   @relation(fields: [groupId], references: [id])
  
  @@unique([studentId, groupId])
  @@map("student_groups")
}

model Lesson {
  id          Int       @id @default(autoincrement())
  groupId     Int       @map("group_id")
  title       String?   @db.VarChar(255)
  description String?   @db.Text
  lessonDate  DateTime  @map("lesson_date") @db.Date
  startTime   DateTime  @map("start_time") @db.Time
  endTime     DateTime  @map("end_time") @db.Time
  roomNumber  String?   @map("room_number") @db.VarChar(20)
  createdBy   Int       @map("created_by")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  
  group       Group        @relation(fields: [groupId], references: [id])
  creator     Staff        @relation(fields: [createdBy], references: [id])
  attendances Attendance[]
  
  @@map("lessons")
}

model Attendance {
  id        Int      @id @default(autoincrement())
  lessonId  Int      @map("lesson_id")
  createdBy Int      @map("created_by")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  lesson  Lesson             @relation(fields: [lessonId], references: [id])
  creator Staff              @relation(fields: [createdBy], references: [id])
  details AttendanceDetail[]
  
  @@map("attendance")
}

model AttendanceDetail {
  id           Int              @id @default(autoincrement())
  attendanceId Int              @map("attendance_id")
  studentId    Int              @map("student_id")
  status       AttendanceStatus
  comment      String?          @db.Text
  
  attendance Attendance @relation(fields: [attendanceId], references: [id])
  student    Student    @relation(fields: [studentId], references: [id])
  
  @@unique([attendanceId, studentId])
  @@map("attendance_details")
}

model Payment {
  id            Int           @id @default(autoincrement())
  studentId     Int           @map("student_id")
  groupId       Int           @map("group_id")
  amount        Int
  paymentDate   DateTime      @default(now()) @map("payment_date") @db.Date
  paymentMethod PaymentMethod @map("payment_method")
  description   String?       @db.Text
  receiptNumber String?       @map("receipt_number") @db.VarChar(50)
  createdBy     Int           @map("created_by")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  
  student Student @relation(fields: [studentId], references: [id])
  group   Group   @relation(fields: [groupId], references: [id])
  creator Staff   @relation(fields: [createdBy], references: [id])
  
  @@map("payments")
}

model Schedule {
  id         Int       @id @default(autoincrement())
  groupId    Int       @map("group_id")
  day        DayOfWeek
  startTime  DateTime  @map("start_time") @db.Time
  endTime    DateTime  @map("end_time") @db.Time
  roomNumber String?   @map("room_number") @db.VarChar(20)
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  
  group Group @relation(fields: [groupId], references: [id])
  
  @@unique([groupId, day, startTime])
  @@map("schedule")
}